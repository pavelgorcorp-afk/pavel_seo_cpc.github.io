<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DMC: POC Banner Calculator (2025) — Cards & Crystals Needed for Banner</title>
<meta name="description" content="Find out how many cards and crystals you need in DMC: POC for character or weapon banners: includes pity, cycle step, and 3 luck scenarios." />
  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){
      m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
      m[i].l=1*new Date();
      for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
      k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105999900', 'ym');

    ym(105999900, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/105999900" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->
  <meta name="yandex-verification" content="cff5b9819f591ce3" />

  <style>
    :root {
      --char-color: #3d85c6;
      --weapon-color: #c0392b;

      --bg: #1c1c1e;
      --card-bg: #2c2c2e;
      --text: #ffffff;
      --secondary: #555557;
    }

    body {
      font-family: -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 15px;
      margin: 0;
      display: flex;
      justify-content: center;
    }

    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      width: 100%;
      max-width: 400px;

      /* фон только внутри карточки */
      position: relative;
      overflow: hidden;
    }

    /* === Background images ONLY inside the card === */
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: var(--card-bg-img);
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.35; /* сила картинки */
      z-index: 0;
      transition: opacity .25s ease, background-image .25s ease;
    }

    .card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.65); /* сила затемнения */
      z-index: 1;
    }

    .card > * {
      position: relative;
      z-index: 2;
    }

    /* файлы лежат рядом с index.html */
    .card.mode-char   { --card-bg-img: url("./char.jpg"); }
    .card.mode-weapon { --card-bg-img: url("./weapons.jpg"); }

    /* top bar: tabs + language */
    .topbar{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom: 20px;
    }

    .tabs {
      flex: 1;
      display: flex;
      gap: 5px;
      background: #3a3a3c;
      padding: 5px;
      border-radius: 10px;
      min-width: 0;
    }
    .tab {
      flex: 1;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: 0.3s;
      color: #aaa;
      user-select: none;
      white-space: nowrap;
    }
    .tab.active { background: var(--char-color); color: white; }
    .tab.active.weapon-tab { background: var(--weapon-color); }

    /* language switch */
    .lang-switch {
      display: flex;
      gap: 6px;
      background: #3a3a3c;
      padding: 5px;
      border-radius: 10px;
      flex: 0 0 auto;
    }
    .lang-btn {
      padding: 8px 10px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: transparent;
      color: #aaa;
      font-weight: 800;
      font-size: 0.85rem;
      line-height: 1;
    }
    .lang-btn.active {
      background: #4a4a4c;
      color: #fff;
    }

    h3 {
      margin-top: 0;
      color: var(--char-color);
      text-align: center;
      font-size: 1.1rem;
    }
    .weapon-title { color: var(--weapon-color) !important; }

    label {
      display: block;
      margin: 10px 0 5px;
      font-size: 0.85rem;
      color: #aaa;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 10px;
      border: 1px solid #444;
      background: #3a3a3c;
      color: white;
      box-sizing: border-box;
      font-size: 1rem;
      outline: none;
    }
    input:focus { border-color: var(--char-color); }

    .btn-group { display: flex; gap: 10px; margin-top: 10px; }
    button {
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      width: 100%;
      transition: opacity 0.2s;
    }
    .btn-calc { background: var(--char-color); color: white; flex: 2; }
    .btn-reset { background: var(--secondary); color: white; flex: 1; }
    button:active { opacity: 0.8; }

    .res {
      margin-top: 20px;
      padding: 15px;
      background: #3a3a3c;
      border-radius: 10px;
      font-size: 0.9rem;
      line-height: 1.6;
    }
    .mode-title {
      font-weight: bold;
      display: block;
      margin-top: 10px;
      border-bottom: 1px solid #555;
      padding-bottom: 3px;
    }
    .footer {
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px dashed #555;
      text-align: center;
      font-size: 0.8rem;
      color: #888;
    }
    .donate-id {
      display: inline-block;
      margin-top: 5px;
      color: #ddd;
      background: #444;
      padding: 4px 8px;
      border-radius: 5px;
      font-family: monospace;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <div class="card">

    <div class="topbar">
      <div class="tabs">
        <div id="tabChar" class="tab active" onclick="switchTab('char')">Персонаж</div>
        <div id="tabWeapon" class="tab" onclick="switchTab('weapon')">Оружие</div>
      </div>

      <div class="lang-switch">
        <button id="langRu" class="lang-btn active" onclick="setLang('ru')">RU</button>
        <button id="langEn" class="lang-btn" onclick="setLang('en')">EN</button>
      </div>
    </div>

    <h3 id="mainTitle">Калькулятор Персонажа</h3>

    <!-- ПЕРСОНАЖ -->
    <div id="charFields">
      <label id="lblLevels">Нужно уровней (копий):</label>
      <input type="number" id="levels" value="1" min="1" />

      <label id="lblStep">Текущий шаг цикла (1-5):</label>
      <select id="currentStep">
        <option value="0" data-ru="1 (За 10)" data-en="1 (Cost 10)">1 (За 10)</option>
        <option value="1" data-ru="2 (За 5)" data-en="2 (Cost 5)">2 (За 5)</option>
        <option value="2" data-ru="3 (За 10)" data-en="3 (Cost 10)">3 (За 10)</option>
        <option value="3" data-ru="4 (За 10)" data-en="4 (Cost 10)">4 (За 10)</option>
        <option value="4" data-ru="5 (БЕСПЛАТНЫЙ)" data-en="5 (FREE)">5 (БЕСПЛАТНЫЙ)</option>
      </select>

      <label id="lblCharPity">Счетчик гаранта (сейчас):</label>
      <input type="number" id="charPity" value="90" min="20" max="90" />

      <label id="lblCharG">Есть 100% гарант на персонажа?</label>
      <select id="charGuaranteed">
        <option value="no" data-ru="Нет (50/50)" data-en="No (50/50)">Нет (50/50)</option>
        <option value="yes" data-ru="Да (100%)" data-en="Yes (100%)">Да (100%)</option>
      </select>
    </div>

    <!-- ОРУЖИЕ -->
    <div id="weaponFields" style="display:none;">
      <label id="lblWepCount">Нужно копий оружия:</label>
      <input type="number" id="wepCount" value="1" min="1" />

      <label id="lblWepPity">Счетчик гаранта (сейчас):</label>
      <input type="number" id="wepPity" value="90" min="20" max="90" />

      <label id="lblWepG">Есть 100% гарант на оружие?</label>
      <select id="wepGuaranteed">
        <option value="no" data-ru="Нет (50/50)" data-en="No (50/50)">Нет (50/50)</option>
        <option value="yes" data-ru="Да (100%)" data-en="Yes (100%)">Да (100%)</option>
      </select>
    </div>

    <div class="btn-group">
      <button id="calcBtn" class="btn-calc" onclick="calculate()">Рассчитать</button>
      <button id="resetBtn" class="btn-reset" onclick="resetPage()">Сброс</button>
    </div>

    <div id="result" class="res">Результаты появятся здесь...</div>

    <div class="footer">
      <span id="footerText">Благодарность автору (In-game ID):</span><br />
      <div class="donate-id">115290070957</div>
    </div>
  </div>

  <script>
    let currentMode = "char";
    let currentLang = "ru";

    const I18N = {
      ru: {
        tabChar: "Персонаж",
        tabWeapon: "Оружие",
        titleChar: "Калькулятор Персонажа",
        titleWeapon: "Калькулятор Оружия",

        lblLevels: "Нужно уровней (копий):",
        lblStep: "Текущий шаг цикла (1-5):",
        lblCharPity: "Счетчик гаранта (сейчас):",
        lblCharG: "Есть 100% гарант на персонажа?",

        lblWepCount: "Нужно копий оружия:",
        lblWepPity: "Счетчик гаранта (сейчас):",
        lblWepG: "Есть 100% гарант на оружие?",

        btnCalc: "Рассчитать",
        btnReset: "Сброс",

        resultPlaceholder: "Результаты появятся здесь...",
        footerText: "Благодарность автору (In-game ID):",

        resLuckyTitle: "● Супер удача (Выпадает на 20)",
        resCharMixedTitle: "● Обычная (среднее 50/50)",
        resWepMixedTitle: "● Обычная (шанс 50/50)",
        resWorstTitle: "● Худший случай (по 140)",
        resCards: "Карт",
        resCrystals: "Кристаллов"
      },
      en: {
        tabChar: "Character",
        tabWeapon: "Weapon",
        titleChar: "Character Calculator",
        titleWeapon: "Weapon Calculator",

        lblLevels: "Copies needed:",
        lblStep: "Current cycle step (1-5):",
        lblCharPity: "Pity counter (now):",
        lblCharG: "Do you have 100% guarantee for character?",

        lblWepCount: "Weapon copies needed:",
        lblWepPity: "Pity counter (now):",
        lblWepG: "Do you have 100% guarantee for weapon?",

        btnCalc: "Calculate",
        btnReset: "Reset",

        resultPlaceholder: "Results will appear here...",
        footerText: "Thanks to the author (In-game ID):",

        resLuckyTitle: "● Super luck (drops at 20)",
        resCharMixedTitle: "● Normal (avg 50/50)",
        resWepMixedTitle: "● Normal (50/50 chance)",
        resWorstTitle: "● Worst case (140 each)",
        resCards: "Cards",
        resCrystals: "Crystals"
      }
    };

    function translateOptions() {
      const langKey = currentLang === "en" ? "en" : "ru";

      const stepSel = document.getElementById("currentStep");
      if (stepSel) {
        Array.from(stepSel.options).forEach(opt => {
          const txt = opt.getAttribute(langKey === "en" ? "data-en" : "data-ru");
          if (txt) opt.text = txt;
        });
      }

      const cg = document.getElementById("charGuaranteed");
      if (cg) {
        Array.from(cg.options).forEach(opt => {
          const txt = opt.getAttribute(langKey === "en" ? "data-en" : "data-ru");
          if (txt) opt.text = txt;
        });
      }

      const wg = document.getElementById("wepGuaranteed");
      if (wg) {
        Array.from(wg.options).forEach(opt => {
          const txt = opt.getAttribute(langKey === "en" ? "data-en" : "data-ru");
          if (txt) opt.text = txt;
        });
      }
    }

    function setLang(lang, persist = true) {
      currentLang = (lang === "en") ? "en" : "ru";

      document.getElementById("langRu").classList.toggle("active", currentLang === "ru");
      document.getElementById("langEn").classList.toggle("active", currentLang === "en");

      const t = I18N[currentLang];

      document.getElementById("tabChar").innerText = t.tabChar;
      document.getElementById("tabWeapon").innerText = t.tabWeapon;

      document.getElementById("lblLevels").innerText = t.lblLevels;
      document.getElementById("lblStep").innerText = t.lblStep;
      document.getElementById("lblCharPity").innerText = t.lblCharPity;
      document.getElementById("lblCharG").innerText = t.lblCharG;

      document.getElementById("lblWepCount").innerText = t.lblWepCount;
      document.getElementById("lblWepPity").innerText = t.lblWepPity;
      document.getElementById("lblWepG").innerText = t.lblWepG;

      document.getElementById("calcBtn").innerText = t.btnCalc;
      document.getElementById("resetBtn").innerText = t.btnReset;

      document.getElementById("footerText").innerText = t.footerText;

      translateOptions();

      const title = document.getElementById("mainTitle");
      const isChar = currentMode === "char";
      title.innerText = isChar ? t.titleChar : t.titleWeapon;

      const resEl = document.getElementById("result");
      const ruP = I18N.ru.resultPlaceholder;
      const enP = I18N.en.resultPlaceholder;

      if (resEl && (resEl.innerText.trim() === ruP || resEl.innerText.trim() === enP)) {
        resEl.innerText = t.resultPlaceholder;
      } else {
        calculate();
      }

      if (persist) {
        try { localStorage.setItem("dmc_lang", currentLang); } catch(e){}
      }
    }

    function switchTab(mode) {
      currentMode = mode;
      const isChar = mode === "char";

      document.getElementById("tabChar").classList.toggle("active", isChar);
      document.getElementById("tabWeapon").classList.toggle("active", !isChar);
      document.getElementById("tabWeapon").classList.toggle("weapon-tab", !isChar);

      document.getElementById("charFields").style.display = isChar ? "block" : "none";
      document.getElementById("weaponFields").style.display = isChar ? "none" : "block";

      const title = document.getElementById("mainTitle");
      const t = I18N[currentLang];
      title.innerText = isChar ? t.titleChar : t.titleWeapon;
      title.className = isChar ? "" : "weapon-title";

      document.getElementById("calcBtn").style.background = isChar ? "var(--char-color)" : "var(--weapon-color)";

      // ✅ фон только под карточкой
      const card = document.querySelector(".card");
      card.classList.toggle("mode-char", isChar);
      card.classList.toggle("mode-weapon", !isChar);
    }

    // Персонаж
    function calculateCharacter(count, startStep, currentPity, startGuaranteed) {
      const stepCosts = [10, 5, 10, 10, 0];
      const cyclePulls = 70;
      const pullsPerStep = 10;
      const cycleSteps = cyclePulls / pullsPerStep; // 7
      const crystalRate = 180;

      count = Math.max(0, parseInt(count) || 0);
      startStep = ((parseInt(startStep) || 0) % 5 + 5) % 5;
      currentPity = Math.min(90, Math.max(20, parseInt(currentPity) || 90));
      startGuaranteed = !!startGuaranteed;

      if (count === 0) {
        return {
          lucky: { cards: 0, crystals: 0 },
          mixed: { cards: 0, crystals: 0 },
          worst: { cards: 0, crystals: 0 }
        };
      }

      const firstLegendPulls = Math.max(0, currentPity - 20);
      const firstLegendSteps = Math.ceil(firstLegendPulls / pullsPerStep);

      function simulateByTotalCycles(totalCycles) {
        if (totalCycles <= 0) return { cards: 0, crystals: 0 };

        const totalSteps = firstLegendSteps + (totalCycles - 1) * cycleSteps;

        let stepIdx = startStep;
        let totalCards = 0;

        for (let i = 0; i < totalSteps; i++) {
          totalCards += stepCosts[stepIdx % 5];
          stepIdx++;
        }

        return {
          cards: totalCards,
          crystals: totalCards * crystalRate
        };
      }

      const luckyCycles = count;

      const attempts = startGuaranteed ? Math.max(0, count - 1) : count;
      const lossesAvg = Math.floor(attempts / 2);
      const mixedCycles = count + lossesAvg;

      const worstCycles = startGuaranteed ? (2 * count - 1) : (2 * count);

      return {
        lucky: simulateByTotalCycles(luckyCycles),
        mixed: simulateByTotalCycles(mixedCycles),
        worst: simulateByTotalCycles(worstCycles)
      };
    }

    // Оружие (1 pull = 1 card)
    function calculateWeapon(count, currentPity, startGuaranteed) {
      const cyclePulls = 70;
      const crystalRate = 180;

      count = Math.max(0, parseInt(count) || 0);
      currentPity = Math.min(90, Math.max(20, parseInt(currentPity) || 90));
      startGuaranteed = !!startGuaranteed;

      if (count === 0) {
        return {
          lucky: { cards: 0, crystals: 0 },
          mixed: { cards: 0, crystals: 0 },
          worst: { cards: 0, crystals: 0 }
        };
      }

      const firstLegendPulls = Math.max(0, currentPity - 20);

      function simulateByTotalCycles(totalCycles) {
        if (totalCycles <= 0) return { cards: 0, crystals: 0 };

        const totalPulls = firstLegendPulls + (totalCycles - 1) * cyclePulls;

        return {
          cards: totalPulls,
          crystals: totalPulls * crystalRate
        };
      }

      const luckyCycles = count;

      const attempts = startGuaranteed ? Math.max(0, count - 1) : count;
      const lossesAvg = Math.floor(attempts / 2);
      const mixedCycles = count + lossesAvg;

      const worstCycles = startGuaranteed ? (2 * count - 1) : (2 * count);

      return {
        lucky: simulateByTotalCycles(luckyCycles),
        mixed: simulateByTotalCycles(mixedCycles),
        worst: simulateByTotalCycles(worstCycles)
      };
    }

    function calculate() {
      let out = "";
      const t = I18N[currentLang];

      if (currentMode === "char") {
        const count = parseInt(document.getElementById("levels").value) || 0;
        const startStep = parseInt(document.getElementById("currentStep").value);
        const currentPity = parseInt(document.getElementById("charPity").value) || 90;
        const startGuar = document.getElementById("charGuaranteed").value === "yes";

        const res = calculateCharacter(count, startStep, currentPity, startGuar);

        out += `<span class="mode-title" style="color:var(--char-color)">${t.resLuckyTitle}</span>`;
        out += `${t.resCards}: <b>${res.lucky.cards}</b> | ${t.resCrystals}: <b>${res.lucky.crystals.toLocaleString()}</b><br>`;

        out += `<span class="mode-title" style="color:var(--char-color)">${t.resCharMixedTitle}</span>`;
        out += `${t.resCards}: <b>${res.mixed.cards}</b> | ${t.resCrystals}: <b>${res.mixed.crystals.toLocaleString()}</b><br>`;

        out += `<span class="mode-title" style="color:var(--char-color)">${t.resWorstTitle}</span>`;
        out += `${t.resCards}: <b>${res.worst.cards}</b> | ${t.resCrystals}: <b>${res.worst.crystals.toLocaleString()}</b><br>`;

      } else {
        const count = parseInt(document.getElementById("wepCount").value) || 0;
        const currentPity = parseInt(document.getElementById("wepPity").value) || 90;
        const startG = document.getElementById("wepGuaranteed").value === "yes";

        const res = calculateWeapon(count, currentPity, startG);

        out += `<span class="mode-title" style="color:var(--weapon-color)">${t.resLuckyTitle}</span>`;
        out += `${t.resCards}: <b>${res.lucky.cards}</b> | ${t.resCrystals}: <b>${res.lucky.crystals.toLocaleString()}</b><br>`;

        out += `<span class="mode-title" style="color:var(--weapon-color)">${t.resWepMixedTitle}</span>`;
        out += `${t.resCards}: <b>${res.mixed.cards}</b> | ${t.resCrystals}: <b>${res.mixed.crystals.toLocaleString()}</b><br>`;

        out += `<span class="mode-title" style="color:var(--weapon-color)">${t.resWorstTitle}</span>`;
        out += `${t.resCards}: <b>${res.worst.cards}</b> | ${t.resCrystals}: <b>${res.worst.crystals.toLocaleString()}</b><br>`;
      }

      document.getElementById("result").innerHTML = out;
    }

    function resetPage() {
      if (currentMode === "char") {
        document.getElementById("levels").value = 1;
        document.getElementById("currentStep").value = 0;
        document.getElementById("charPity").value = 90;
        document.getElementById("charGuaranteed").value = "no";
      } else {
        document.getElementById("wepCount").value = 1;
        document.getElementById("wepPity").value = 90;
        document.getElementById("wepGuaranteed").value = "no";
      }

      const t = I18N[currentLang];
      document.getElementById("result").innerHTML = t.resultPlaceholder;
      switchTab(currentMode);
    }

    // init tab + background
    switchTab(currentMode);

    // ✅ auto language:
    // 1) saved lang -> use it
    // 2) else browser language: ru* => RU, else EN
    (function initLanguage(){
      let saved = null;
      try { saved = localStorage.getItem("dmc_lang"); } catch(e){}
      if (saved === "ru" || saved === "en") {
        setLang(saved, false);
        return;
      }
      const nav = (navigator.language || navigator.userLanguage || "en").toLowerCase();
      const auto = nav.startsWith("ru") ? "ru" : "en";
      setLang(auto, true);
    })();
  </script>
</body>
</html>


